<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Behavior Mirror</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ================================
   BEHAVIOR MIRROR — FINAL BUILD
================================ */

body {
    margin: 0;
    font-family: system-ui, sans-serif;
    background: #f2f2f2;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    transition: background 0.5s;
}

body.dark {
    background: #080808;
    color: #eee;
}

.app {
    width: 360px;
    background: white;
    padding: 24px;
    border-radius: 10px;
    box-shadow: 0 0 30px rgba(0,0,0,0.25);
    text-align: center;
}

body.dark .app {
    background: #111;
}

h2 {
    margin-top: 0;
}

.grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
    margin: 20px 0;
}

.tile {
    height: 70px;
    background: #ccc;
    cursor: pointer;
    border-radius: 4px;
    transition: 0.2s;
}

.tile:hover {
    transform: scale(1.05);
}

.controls {
    display: flex;
    gap: 10px;
    justify-content: center;
}

button {
    padding: 8px 14px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

#easy { background: #2196f3; color: white; }
#reset { background: #4caf50; color: white; }

.message {
    height: 24px;
    margin: 10px 0;
    color: #555;
}

.stat {
    font-size: 13px;
    margin-top: 5px;
}

.overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.9);
    color: white;
    display: none;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 40px;
}
</style>
</head>

<body>

<div class="app">
    <h2>Behavior Mirror</h2>
    <div class="message" id="msg">Click the different tile.</div>
    <div class="grid" id="grid"></div>

    <div class="stat">Focus Level: <span id="focus">100</span></div>
    <div class="stat">Reaction Score: <span id="score">0</span></div>

    <div class="controls">
        <button id="easy">Easy</button>
        <button id="reset">Reset</button>
    </div>
</div>

<div class="overlay" id="overlay">
    <div>
        <h2>Pause</h2>
        <p>This experiment reacts to frustration.</p>
        <p>You can close it anytime.</p>
        <button onclick="location.reload()">Restart</button>
    </div>
</div>

<script>
/* ================================
   STATE
================================ */
let correct = 0;
let score = 0;
let focus = 100;
let rage = 0;
let lastClick = Date.now();
let dark = false;

const grid = document.getElementById("grid");
const msg = document.getElementById("msg");
const focusEl = document.getElementById("focus");
const scoreEl = document.getElementById("score");
const overlay = document.getElementById("overlay");

/* ================================
   INIT
================================ */
function init() {
    buildGrid();
}
init();

/* ================================
   GRID
================================ */
function buildGrid() {
    grid.innerHTML = "";
    const base = rand(120,170);
    correct = rand(0,15);

    for(let i=0;i<16;i++){
        const d = document.createElement("div");
        d.className = "tile";
        d.style.background =
            i === correct
            ? `rgb(${base+3},${base+3},${base+3})`
            : `rgb(${base},${base},${base})`;

        d.onclick = () => clickTile(i);
        grid.appendChild(d);
    }
}

/* ================================
   CLICK LOGIC
================================ */
function clickTile(i){
    const now = Date.now();
    const delta = now - lastClick;
    lastClick = now;

    // behavior tracking
    if(delta < 200) rage += 2;
    if(delta > 1500) rage += 1;

    // deception
    if(Math.random() < 0.75){
        msg.textContent = randomMsg();
    } else {
        msg.textContent = "Correct.";
        score++;
    }

    focus -= Math.floor(Math.random() * 5 + 1);
    updateStats();

    if(focus <= 0){
        showOverlay();
    }

    buildGrid();
}

/* ================================
   EASY BUTTON TRAP
================================ */
document.getElementById("easy").onclick = () => {
    document.body.classList.add("dark");
    msg.textContent = "It doesn’t get easier.";
};

/* ================================
   RESET
================================ */
document.getElementById("reset").onclick = () => {
    location.reload();
};

/* ================================
   UTIL
================================ */
function updateStats(){
    focusEl.textContent = focus;
    scoreEl.textContent = score;
}

function rand(a,b){
    return Math.floor(Math.random()*(b-a))+a;
}

function randomMsg(){
    const lines = [
        "Too fast.",
        "Too slow.",
        "Not quite.",
        "Try again.",
        "Focus.",
        "Almost.",
        "You hesitated.",
        "Wrong timing.",
        "Overthinking.",
        "Missed it."
    ];
    return lines[Math.floor(Math.random()*lines.length)];
}

function showOverlay(){
    overlay.style.display = "flex";
}
</script>

</body>
</html>
